import{u as F,D as g,r as m,j as e,B}from"./index-CjjJJCP1.js";import{u as E}from"./NotificationHelpers-Bf1Iqgmh.js";class p{static generateBookId(){return`book_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static async uploadPDF(t,r,o){try{const i=this.generateBookId();o({status:"uploading",progress:10,message:"Uploading PDF file...",fileName:r.file.name,bookId:i}),await new Promise(c=>setTimeout(c,1500)),o({status:"uploading",progress:40,message:"File uploaded successfully",fileName:r.file.name,bookId:i}),o({status:"processing",progress:50,message:"Creating book entry...",fileName:r.file.name,bookId:i});const n={id:i,user_id:t,title:r.title||r.file.name.replace(".pdf",""),author:r.author||"Unknown Author",cover_url:`https://via.placeholder.com/300x450/4A90E2/ffffff?text=${encodeURIComponent(r.title||"Book")}`,pdf_file_url:`uploads/${t}/${i}/${r.file.name}`,audio_file_url:null,duration_seconds:0,total_chapters:1,genre:r.category||"General",category:r.category||"General",rating:0,description:r.description||`Uploaded PDF: ${r.file.name}`,processing_status:"processing",file_size_bytes:r.file.size,language:"en",progress:0},a=await g.createBook(n);if(!a.success)throw new Error(a.error||"Failed to create book entry");o({status:"processing",progress:70,message:"Converting to audio...",fileName:r.file.name,bookId:i}),await new Promise(c=>setTimeout(c,2e3)),o({status:"processing",progress:90,message:"Finalizing conversion...",fileName:r.file.name,bookId:i});const u=`audio/${t}/${i}/converted.mp3`,f=Math.floor(r.file.size/1e3),h={audio_file_url:u,duration_seconds:f,processing_status:"completed"};return await new Promise(c=>setTimeout(c,500)),o({status:"completed",progress:100,message:"Conversion completed successfully!",fileName:r.file.name,bookId:i}),await g.createNotification(t,{title:"PDF Upload Complete",message:`"${r.title||r.file.name}" has been converted to audio and added to your library.`,type:"success",action_type:"navigate_to_book",action_data:{bookId:i},priority:2}),{success:!0,bookId:i}}catch(i){return console.error("PDF upload error:",i),o({status:"error",progress:0,message:i instanceof Error?i.message:"Upload failed",fileName:r.file?.name}),t&&await g.createNotification(t,{title:"Upload Failed",message:`Failed to upload "${r.file?.name||"PDF"}". Please try again.`,type:"warning",priority:2}),{success:!1,error:i instanceof Error?i.message:"Upload failed"}}}static async validatePDFFile(t){if(t.type!=="application/pdf")return{valid:!1,error:"Please select a PDF file"};const r=50*1024*1024;return t.size>r?{valid:!1,error:"File size must be less than 50MB"}:t.size===0?{valid:!1,error:"File appears to be empty"}:{valid:!0}}static getUploadStatusIcon(t){switch(t){case"uploading":return"📤";case"processing":return"⚙️";case"completed":return"✅";case"error":return"❌";default:return"📄"}}static getUploadStatusColor(t){switch(t){case"uploading":case"processing":return"#4A90E2";case"completed":return"#10B981";case"error":return"#EF4444";default:return"#6B7280"}}}function P(){const{user:d}=F();return{uploadPDF:async(o,i)=>{if(!d?.id)throw new Error("User must be authenticated to upload PDFs");return await p.uploadPDF(d.id,o,i)},validateFile:o=>p.validatePDFFile(o),getStatusIcon:p.getUploadStatusIcon,getStatusColor:p.getUploadStatusColor,isAuthenticated:!!d?.id}}function R({onNavigate:d}){const[t,r]=m.useState({status:"idle",progress:0,message:""}),[o,i]=m.useState(null),[n,a]=m.useState({title:"",author:"",category:"General",description:""}),u=m.useRef(null);E();const{uploadPDF:f,validateFile:h,getStatusIcon:c,getStatusColor:j,isAuthenticated:v}=P(),{user:z}=F(),w=l=>{const s=l.target.files?.[0];if(!s)return;const b=h(s);if(!b.valid){alert(b.error);return}i(s),n.title||a(k=>({...k,title:s.name.replace(".pdf","").replace(/[_-]/g," ")}))},S=async()=>{if(!o){alert("Please select a PDF file first");return}if(!v){alert("Please sign in to upload PDFs"),d("login");return}if(!n.title.trim()){alert("Please enter a title for your book");return}const l={title:n.title.trim(),author:n.author.trim()||"Unknown Author",file:o,category:n.category,description:n.description.trim()};try{const s=await f(l,r);s.success?console.log("Upload successful, book ID:",s.bookId):console.error("Upload failed:",s.error)}catch(s){console.error("Upload error:",s),r({status:"error",progress:0,message:s instanceof Error?s.message:"Upload failed",fileName:o.name})}},x=()=>{u.current?.click()},y=()=>{r({status:"idle",progress:0,message:""}),i(null),a({title:"",author:"",category:"General",description:""}),u.current&&(u.current.value="")},C=()=>{if(t.message)return t.message;switch(t.status){case"uploading":return"Uploading PDF...";case"processing":return"Converting to audio...";case"completed":return"Conversion complete!";case"error":return"Upload failed";default:return""}};return e.jsxs("div",{style:{width:"100%",height:"100%",backgroundColor:"#ffffff",display:"flex",flexDirection:"column",fontFamily:"Poppins, sans-serif",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem 1.5rem",borderBottom:"1px solid #F3F4F6"},children:[e.jsx(B,{onClick:()=>d("back"),title:"Go back to previous screen","aria-label":"Return to previous screen"}),e.jsx("h2",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#374151",margin:0},children:"Upload PDF"}),e.jsx("div",{style:{width:"24px"}})]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",padding:"2rem 1.5rem",paddingBottom:"8rem"},children:[t.status==="idle"&&e.jsxs("div",{children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"2rem"},children:[e.jsx("div",{style:{width:"120px",height:"120px",backgroundColor:o?"#E3F2FD":"#F3F4F6",borderRadius:"2rem",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1rem",fontSize:"3rem",border:o?"2px solid #4A90E2":"2px dashed #D1D5DB",cursor:"pointer"},onClick:x,children:o?"📄":"📤"}),e.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},children:o?o.name:"Choose PDF File"}),o&&e.jsxs("p",{style:{color:"#4A90E2",fontSize:"0.875rem",marginBottom:"1rem"},children:["Size: ",(o.size/(1024*1024)).toFixed(2)," MB"]}),e.jsx("input",{ref:u,type:"file",accept:".pdf",onChange:w,style:{display:"none"}}),e.jsx("button",{onClick:x,style:{backgroundColor:"#4A90E2",color:"white",border:"none",borderRadius:"1rem",padding:"0.75rem 1.5rem",fontSize:"0.9rem",fontWeight:"600",cursor:"pointer",fontFamily:"Poppins, sans-serif",boxShadow:"0 4px 12px rgba(74, 144, 226, 0.3)",marginBottom:"1rem"},children:o?"Choose Different File":"Choose PDF File"})]}),o&&e.jsxs("div",{style:{backgroundColor:"#F9FAFB",borderRadius:"1rem",padding:"1.5rem",marginBottom:"2rem"},children:[e.jsx("h4",{style:{fontSize:"1rem",fontWeight:"600",color:"#374151",marginBottom:"1rem"},children:"Book Information"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Title *"}),e.jsx("input",{type:"text",value:n.title,onChange:l=>a(s=>({...s,title:l.target.value})),placeholder:"Enter book title",style:{width:"100%",padding:"0.75rem",border:"1px solid #E5E7EB",borderRadius:"0.5rem",fontSize:"0.9rem",fontFamily:"Poppins, sans-serif",backgroundColor:"#ffffff"}})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Author"}),e.jsx("input",{type:"text",value:n.author,onChange:l=>a(s=>({...s,author:l.target.value})),placeholder:"Enter author name",style:{width:"100%",padding:"0.75rem",border:"1px solid #E5E7EB",borderRadius:"0.5rem",fontSize:"0.9rem",fontFamily:"Poppins, sans-serif",backgroundColor:"#ffffff"}})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Category"}),e.jsxs("select",{value:n.category,onChange:l=>a(s=>({...s,category:l.target.value})),style:{width:"100%",padding:"0.75rem",border:"1px solid #E5E7EB",borderRadius:"0.5rem",fontSize:"0.9rem",fontFamily:"Poppins, sans-serif",backgroundColor:"#ffffff"},children:[e.jsx("option",{value:"General",children:"General"}),e.jsx("option",{value:"Self-Help",children:"Self-Help"}),e.jsx("option",{value:"Business",children:"Business"}),e.jsx("option",{value:"Fiction",children:"Fiction"}),e.jsx("option",{value:"Non-Fiction",children:"Non-Fiction"}),e.jsx("option",{value:"Educational",children:"Educational"}),e.jsx("option",{value:"Biography",children:"Biography"}),e.jsx("option",{value:"Science",children:"Science"}),e.jsx("option",{value:"History",children:"History"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Description (Optional)"}),e.jsx("textarea",{value:n.description,onChange:l=>a(s=>({...s,description:l.target.value})),placeholder:"Brief description of the book",rows:3,style:{width:"100%",padding:"0.75rem",border:"1px solid #E5E7EB",borderRadius:"0.5rem",fontSize:"0.9rem",fontFamily:"Poppins, sans-serif",backgroundColor:"#ffffff",resize:"vertical"}})]})]}),o&&e.jsx("button",{onClick:S,disabled:!n.title.trim(),style:{width:"100%",height:"52px",backgroundColor:n.title.trim()?"#4A90E2":"#9CA3AF",color:"white",border:"none",borderRadius:"1rem",fontSize:"1rem",fontWeight:"600",cursor:n.title.trim()?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",fontFamily:"Poppins, sans-serif",boxShadow:n.title.trim()?"0 4px 12px rgba(74, 144, 226, 0.3)":"none"},children:"🚀 Start Upload & Conversion"}),e.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",backgroundColor:"#F9FAFB",borderRadius:"0.75rem"},children:[e.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},children:"What happens next:"}),e.jsxs("ul",{style:{fontSize:"0.8rem",color:"#6B7280",textAlign:"left",paddingLeft:"1rem",lineHeight:"1.6",margin:0},children:[e.jsx("li",{children:"PDF text will be extracted"}),e.jsx("li",{children:"High-quality audio will be generated"}),e.jsx("li",{children:"Book will be added to your library"}),e.jsx("li",{children:"You'll get notified when ready"})]})]})]}),t.status!=="idle"&&e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:"120px",height:"120px",backgroundColor:j(t.status),borderRadius:"2rem",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 2rem",fontSize:"3rem",color:"white"},children:c(t.status)}),e.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#374151",marginBottom:"0.75rem"},children:C()}),t.fileName&&e.jsx("p",{style:{color:"#6B7280",fontSize:"1rem",marginBottom:"2rem"},children:t.fileName}),t.status!=="completed"&&t.status!=="error"&&e.jsxs("div",{style:{width:"100%",maxWidth:"300px",margin:"0 auto 2rem"},children:[e.jsx("div",{style:{width:"100%",height:"8px",backgroundColor:"#E5E7EB",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",backgroundColor:"#4A90E2",borderRadius:"4px",transition:"width 0.5s ease",width:`${t.progress}%`}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.75rem",color:"#6B7280",marginTop:"0.5rem"},children:[e.jsx("span",{children:"Processing..."}),e.jsxs("span",{children:[t.progress,"%"]})]})]}),(t.status==="completed"||t.status==="error")&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",width:"100%",maxWidth:"280px",margin:"0 auto"},children:[t.status==="completed"?e.jsx("button",{onClick:()=>d("library"),style:{width:"100%",height:"52px",backgroundColor:"#4A90E2",color:"white",border:"none",borderRadius:"1rem",fontSize:"1rem",fontWeight:"600",cursor:"pointer",fontFamily:"Poppins, sans-serif",boxShadow:"0 4px 12px rgba(74, 144, 226, 0.3)"},children:"Go to Library"}):e.jsx("button",{onClick:y,style:{width:"100%",height:"52px",backgroundColor:"#EF4444",color:"white",border:"none",borderRadius:"1rem",fontSize:"1rem",fontWeight:"600",cursor:"pointer",fontFamily:"Poppins, sans-serif",boxShadow:"0 4px 12px rgba(239, 68, 68, 0.3)"},children:"Try Again"}),e.jsx("button",{onClick:y,style:{width:"100%",height:"48px",backgroundColor:"white",color:"#6B7280",border:"1px solid #E5E7EB",borderRadius:"1rem",fontSize:"1rem",fontWeight:"500",cursor:"pointer",fontFamily:"Poppins, sans-serif"},children:t.status==="completed"?"Upload Another":"Cancel"})]})]})]})]})}export{R as UploadPDFScreen};
