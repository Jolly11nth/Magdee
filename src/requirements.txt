# Magdee Python Backend - Requirements
# Updated with compatibility fixes and latest stable versions

# ==========================================
# FastAPI and Core Dependencies
# ==========================================
fastapi==0.109.0  # Updated from 0.104.1 (security patches)
uvicorn[standard]==0.27.0  # Updated from 0.24.0 (performance improvements)
python-multipart==0.0.6
aiofiles==23.2.1
pydantic==2.5.3  # Added explicit pydantic (required by fastapi)
pydantic-settings==2.1.0  # Updated from 2.0.3 (bug fixes)

# ==========================================
# Supabase and Database
# ==========================================
supabase==2.3.4  # Updated from 2.0.3 (critical bug fixes)
httpx==0.25.2  # Updated from 0.25.2 (compatibility with supabase)
postgrest==0.13.2  # Added (required by supabase)
realtime==1.0.5  # Added (required by supabase)
storage3==0.7.4  # Added (required by supabase)
gotrue==2.4.1  # Added (required by supabase)

# Note: asyncpg removed - not needed for Supabase Edge Functions integration
# If you need direct PostgreSQL access, uncomment:
# asyncpg==0.29.0

# ==========================================
# Authentication and Security
# ==========================================
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-dateutil==2.8.2
cryptography==42.0.0  # Added explicit version (security)

# ==========================================
# PDF Processing
# ==========================================
# Note: PyPDF2 is deprecated - using pypdf instead
pypdf==3.17.4  # Updated from 3.17.1 (bug fixes)
pdfplumber==0.10.4  # Updated from 0.10.3 (compatibility)

# Removed deprecated PyPDF2==3.0.1

# PDF processing dependencies
pdfminer.six==20221105  # Required by pdfplumber
charset-normalizer==3.3.2  # Required by pdfminer

# ==========================================
# Audio Processing and TTS
# ==========================================
pydub==0.25.1
gTTS==2.5.0  # Updated from 2.4.0 (new features)
elevenlabs==0.2.27  # Updated from 0.2.26 (bug fixes)

# Audio dependencies
# Note: pydub requires ffmpeg to be installed separately:
# macOS: brew install ffmpeg
# Ubuntu: sudo apt-get install ffmpeg
# Windows: Download from https://ffmpeg.org/download.html

# ==========================================
# Data Processing
# ==========================================
pandas==2.1.4  # Updated from 2.1.3 (security patches)
numpy==1.26.3  # Updated from 1.25.2 (compatibility with pandas 2.1.4)
python-json-logger==2.0.7

# ==========================================
# Utilities
# ==========================================
Pillow==10.2.0  # Updated from 10.1.0 (security fixes - CVE-2023-50447)
requests==2.31.0
python-dotenv==1.0.0
email-validator==2.1.0  # Added (good practice for API validation)

# ==========================================
# Development and Testing
# ==========================================
pytest==7.4.4  # Updated from 7.4.3 (bug fixes)
pytest-asyncio==0.23.3  # Updated from 0.21.1 (async improvements)
pytest-cov==4.1.0  # Added (coverage reporting)
black==24.1.1  # Updated from 23.10.1 (formatting improvements)
flake8==7.0.0  # Updated from 6.1.0 (new rules)
isort==5.13.2  # Added (import sorting)

# Testing utilities
httpx==0.25.2  # Already listed above but needed for testing
pytest-mock==3.12.0  # Added (mocking support)

# Security scanning
safety==3.0.1  # Added (dependency vulnerability scanning)
bandit==1.7.6  # Added (security linting)

# ==========================================
# Type Checking (Optional but Recommended)
# ==========================================
mypy==1.8.0  # Added (static type checking)
types-requests==2.31.0.20240125  # Added (type stubs)

# ==========================================
# IMPORTANT NOTES
# ==========================================
# 
# 1. COMPATIBILITY ISSUES FIXED:
#    - Removed deprecated PyPDF2 (use pypdf instead)
#    - Updated Pillow (security vulnerability CVE-2023-50447)
#    - Updated numpy for pandas 2.1.4 compatibility
#    - Added missing Supabase dependencies
#    - Updated supabase client to latest stable
#
# 2. BREAKING CHANGES:
#    - If you were using PyPDF2, switch to pypdf (same API)
#    - numpy 1.26.x has minor API changes from 1.25.x
#
# 3. SECURITY UPDATES:
#    - Pillow: CVE-2023-50447 fixed in 10.2.0
#    - FastAPI: Multiple security patches in 0.109.0
#    - Added cryptography with explicit secure version
#
# 4. MISSING SYSTEM DEPENDENCIES:
#    - ffmpeg (for pydub audio processing)
#    - Install: brew install ffmpeg (macOS)
#              sudo apt-get install ffmpeg (Ubuntu)
#
# 5. PYTHON VERSION REQUIREMENT:
#    - Python 3.9+ required
#    - Python 3.11 recommended for best performance
#
# 6. INSTALLATION:
#    pip install -r requirements.txt
#
# 7. UPGRADE EXISTING ENVIRONMENT:
#    pip install -r requirements.txt --upgrade
#
# ==========================================
